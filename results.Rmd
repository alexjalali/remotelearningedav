# Results

## Packages

```{r}
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geojsonio)
library(sp)
library(tidytext)
#for pcp
library(hrbrthemes)
library(GGally)
library(viridis)
library(wesanderson)
library(ggpubr)
library(cowplot)
json_map <- geojson_read("https://raw.githubusercontent.com/alexjalali/remotelearningedav/main/School%20Districts.geojson", what = "sp")

df <- read.csv(file='./datasets/DataClean.csv')
df_total <- subset(df, Category == "total") #dataframe with just aggregates
```


## Section 1: Remote Learning Preferences for different districts

### Plot from JSON

```{r}
layout(matrix(1:2,ncol=2), width = c(3,1),height = c(1,1))
plot(json_map, col = alpha("red", (df$PercentRemote[as.numeric(json_map$school_dist)*15]-53)/24), main = "Heat Map for Remote Learning")
legend_image <- as.raster(matrix(colorRampPalette(c("red", "white"))(20), ncol=1))
plot(c(0,2),c(0,1),type = 'n', xlab = '', ylab = '', axes = F)
text(x=1.5, y = seq(0,1,l=15), 
     labels = c('50%','52%','54%','56%','58%','60%','62%','64%','66%','68%','70%','72%','74%','76%', '78%'), 
     cex = 0.5)
rasterImage(legend_image, 0, 0, 1, 1) 
```

### Normal bar plot of remote learning preferences

```{r}
p1 <- ggplot(df_total, aes(PercentRemote)) +
  geom_histogram(binwidth = 2.5, boundary = 60,
                 col = "navajowhite4",bins=20,fill="honeydew3")+
  xlab("Percent Remote (%)")+
  ylab("Frequency")+
  scale_x_continuous(breaks=50:80)+
  xlim(50,80)+
  ggtitle("Histogram of Percent of Students who Prefer Remote Learning per District")

p1
```


### Cleveland dot plot of remote learning preferences per district (Order by Highest to Lowest)
```{r}
district_remover_per_reorder <- fct_reorder(as.character(df_total$District), df_total$PercentRemote, min)

p2 <- ggplot(df_total, aes(PercentRemote,district_remover_per_reorder)) +
  geom_point(color = "darksalmon") +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle(str_wrap("Cleveland dot plot of Percent of Students who Prefer Remote Learning per District"))
p2
```

## Section 2: Comparing same category across different districts
### Cleveland dot plot showing gender vs. remote learning AND ELL vs. remote learning

```{r}
gender_plot <- df%>%filter(DisaggregationCategory == "Gender")
district_remover_per_reorder2 <- fct_reorder(as.character(gender_plot$District), gender_plot$PercentRemote)

p3 <- ggplot(gender_plot, aes(PercentRemote,district_remover_per_reorder2)) +
  geom_point(aes(color =Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing gender vs. remote learning per District")
p3
```

```{r}
ELL_plot <- df%>%filter(DisaggregationCategory == "English Language Learner Status")
district_remover_per_reorder3 <- fct_reorder(as.character(ELL_plot$District), ELL_plot$PercentRemote)

p4 <- ggplot(ELL_plot, aes(PercentRemote,district_remover_per_reorder3)) +
  geom_point(aes(color=Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing ELL vs. remote learning per District")
p4
```


```{r}
Ethnicity_plot <- df%>%filter(DisaggregationCategory == "Race or Ethnicity")
district_remover_per_reorder3 <- fct_reorder(as.character(Ethnicity_plot$District), Ethnicity_plot$PercentRemote)

p4_1 <- ggplot(Ethnicity_plot, aes(PercentRemote,district_remover_per_reorder3)) +
  geom_point(aes(color=Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing Race/Ethnicity vs. remote learning per District")
p4_1
```

### Two Cleveland dot plot with facets showing ethnicity and grade

```{r fig.height=3.5}

Ethnicity_plot <- df%>%filter(DisaggregationCategory == "Race or Ethnicity")

p5 <- ggplot(Ethnicity_plot, aes(y = reorder_within(District, PercentRemote, Category), x = PercentRemote)) +
    geom_point(color="darksalmon",stat = "identity") + scale_y_reordered() +
    facet_wrap(Category ~ ., ncol = 4, scales = "free_y", strip.position = "right", )+xlab("% Remote")+ ylab("District") + ggtitle("Cleveland dot plot of Percent with facets showing Race or Ethnicity") +
  theme(axis.text.y = element_text(size = 5))

p5
```

```{r}
Grade_plot <- df%>%filter(DisaggregationCategory == "Grade Level")
district_remover_per_reorder4 <- fct_reorder(as.character(Grade_plot$District), Grade_plot$PercentRemote)

p6_1 <- ggplot(Grade_plot, aes(PercentRemote,district_remover_per_reorder4)) +
  geom_point(aes(color=Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing Grade Level vs. remote learning per District")
p6_1
```

```{r fig.height=4 }

Grade_plot <- df%>%filter(DisaggregationCategory == "Grade Level") %>%filter(Category <= "5")

p6 <- ggplot(Grade_plot, aes(y = reorder_within(District, PercentRemote, Category), x = PercentRemote)) +
    geom_point(color="darksalmon",stat = "identity") + scale_y_reordered() +
    facet_wrap(Category ~ ., ncol = 3, scales = "free_y", strip.position = "right")+ ylab("District") + ggtitle("Cleveland dot plot of Percent with facets showing Grade Label") +
  theme(axis.text.y = element_text(size = 5))

p6
```

```{r}
Grade_plot <- df%>%filter(DisaggregationCategory == "Grade Level") %>%filter(Category > "5")

p7 <- ggplot(Grade_plot, aes(y = reorder_within(District, PercentRemote, Category), x = PercentRemote)) +
    geom_point(color="darksalmon",stat = "identity") + scale_y_reordered() +
    facet_wrap(Category ~ ., ncol = 3, scales = "free_y", strip.position = "right")+xlab("% Remote")+ ylab("District") + theme(axis.text.y = element_text(size = 5))

p7
```

## Part 3

### ELL proportion vs Remote Learning Preferences

```{r}
df$ELLpercent = 0
df$Asianpercent = 0
df$Blackpercent = 0
df$Hispanicpercent = 0
df$Whitepercent = 0
for (x in 1:31){
  df$ELLpercent[15*x] = 100*df$TotalEnrollment[15*(x-1) + 1]/df$TotalEnrollment[15*x]
  df$Asianpercent[15*x] = 100*df$TotalEnrollment[15*(x-1) + 11]/df$TotalEnrollment[15*x]
  df$Blackpercent[15*x] = 100*df$TotalEnrollment[15*(x-1) + 12]/df$TotalEnrollment[15*x]
  df$Hispanicpercent[15*x] = 100*df$TotalEnrollment[15*(x-1) + 13]/df$TotalEnrollment[15*x]
  df$Whitepercent[15*x] = 100*df$TotalEnrollment[15*(x-1) + 14]/df$TotalEnrollment[15*x]
}
proportion <- df%>%filter(DisaggregationCategory == "total")
ggplot(proportion, aes(x = ELLpercent, y = PercentRemote)) + 
    geom_point(color="salmon") + xlab("ELL Percentage") + geom_smooth(method = "lm")

```

### Race/Ethnicity proporation vs Remote Learning Preferences

```{r}
plot_1 <- ggplot(proportion, aes(x = Asianpercent, y = PercentRemote)) + 
    geom_point(color = "salmon") + xlab("Asian") + geom_smooth(method = "lm")
plot_2 <- ggplot(proportion, aes(x = Blackpercent, y = PercentRemote)) + 
    geom_point(color = "olivedrab") + xlab("Black") + geom_smooth(method = "lm")
plot_3 <- ggplot(proportion, aes(x = Hispanicpercent, y = PercentRemote)) + 
    geom_point(color = "cyan3") + xlab("Hispanic") + geom_smooth(method = "lm")
plot_4 <- ggplot(proportion, aes(x = Whitepercent, y = PercentRemote)) + 
    geom_point(color = "mediumorchid2") + xlab("White") + geom_smooth(method = "lm")
plot_grid(plot_1, plot_2, plot_3, plot_4, ncol = 2, nrow = 2)
```


### Parallel coordinates plot

```{r pcp}
#this isn't working i am going to work on this tomorrow
#highlight the clusters based on the Species column
pcpdf <- df_total %>% subset(select=c("ELAScores2019","ELAScores2022","MathScores2019","MathScores2022","remote_cat")) 

#highlight the clusters based on the remote categorical column
pcpplot<-pcpdf %>%  arrange(desc(remote_cat)) %>% ggparcoord(pcpdf, columns=1:4, groupColumn = 5, title = "Parallel Coordiantes Plot for average test scores per district, grouped by percent remote",scale = "globalminmax",
    alphaLines = 0.3)+ 
  scale_fill_hue(l=40)+
theme(
    plot.title = element_text(size=10)
  ) +
  xlab("") + ylab("Scores") + 
  scale_x_discrete(labels = c('ELA Scores 2019','ELA Scores 2022','Math Scores 2019','Math Scores 2022' ))
pcpplot
```

### Boxplot

```{r}
remote_cat_levels <- c("High", "Middle", "Low")
bpELA2019 <- gender_plot %>% 
  mutate(remote_cat = factor(remote_cat, remote_cat_levels)) %>%
  ggplot(aes(x=Category,y=ELAScores2019,col=remote_cat)) + 
  geom_boxplot(alpha=1) + 
  scale_fill_brewer(palette="Paired") +
  ylab("Scores")+ 
  xlab(" ") + 
  labs(col='Remote Preference')

bpELA2022 <- gender_plot %>% 
  mutate(remote_cat = factor(remote_cat, remote_cat_levels)) %>%
  ggplot(aes(col=remote_cat, y=ELAScores2022, x=Category)) + geom_boxplot(alpha=1) +
    scale_fill_brewer(palette="Paired") + 
  ylab(" ")+ 
  xlab(" ")+ 
  labs(col='Remote Preference')

bpMath2019 <- gender_plot %>% 
   mutate(remote_cat = factor(remote_cat, remote_cat_levels)) %>%
  ggplot(aes(col=remote_cat, y=MathScores2019, x=Category)) + geom_boxplot(alpha=1) +
scale_fill_brewer(palette="Paired") + 
ylab("Scores")+ 
xlab(" ")+ 
  labs(col='Remote Preference')

bpMath2022 <- gender_plot %>%
   mutate(remote_cat = factor(remote_cat, remote_cat_levels)) %>%
  ggplot(aes(col=remote_cat, y=MathScores2022, x=Category)) + geom_boxplot(alpha=1) +
    scale_fill_brewer(palette="Paired") + 
  ylab(" ")+ 
  xlab(" ")+ 
  labs(col='Remote Preference')

bptotal <- ggarrange(bpELA2019,bpELA2022,bpMath2019,bpMath2022, ncol = 2, nrow = 2)
bptotal

```

