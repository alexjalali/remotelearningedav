# Results

## Packages

```{r}
library(tidyverse)
library(dplyr)
library(tidyr)
library(ggplot2)
library(geojsonio)
library(sp)
library(tidytext)
#for pcp
library(hrbrthemes)
library(GGally)
library(viridis)
library(wesanderson)
library(ggpubr)
library(cowplot)
json_map <- geojson_read("https://raw.githubusercontent.com/alexjalali/remotelearningedav/main/School%20Districts.geojson", what = "sp")

df <- read.csv(file='./datasets/DataClean.csv')
df_total <- subset(df, Category == "total") #dataframe with just aggregates
```


## Section 1: Remote Learning Preferences for different districts

### Plot from JSON

```{r}
layout(matrix(1:2,ncol=2), width = c(3,1),height = c(1,1))
plot(json_map, col = alpha("red", (df$PercentRemote[as.numeric(json_map$school_dist)*15]-53)/24), main = "Heat Map for Remote Learning")
legend_image <- as.raster(matrix(colorRampPalette(c("red", "white"))(20), ncol=1))
plot(c(0,2),c(0,1),type = 'n', xlab = '', ylab = '', axes = F)
text(x=1.5, y = seq(0,1,l=15), 
     labels = c('50%','52%','54%','56%','58%','60%','62%','64%','66%','68%','70%','72%','74%','76%', '78%'), 
     cex = 0.5)
rasterImage(legend_image, 0, 0, 1, 1) 
```

### Normal bar plot of remote learning preferences

```{r}
p1 <- ggplot(df_total, aes(PercentRemote)) +
  geom_histogram(binwidth = 2.5, boundary = 60,
                 col = "navajowhite4",bins=10,fill="honeydew3")+
  xlab("% Remote")+
  ggtitle("Histogram of Percent of Students who Prefer Remote Learning per District")

p1
```


### Cleveland dot plot of remote learning preferences per district (Order by Highest to Lowest)
```{r}
district_remover_per_reorder <- fct_reorder(as.character(df_total$District), df_total$PercentRemote, min)

p2 <- ggplot(df_total, aes(PercentRemote,district_remover_per_reorder)) +
  geom_point(color = "darksalmon") +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent of Students who Prefer Remote Learning per District")
p2
```

## Section 2: Comparing same category across different districts
### Cleveland dot plot showing gender vs. remote learning AND ELL vs. remote learning

```{r}
gender_plot <- df%>%filter(DisaggregationCategory == "Gender")
district_remover_per_reorder2 <- fct_reorder(as.character(gender_plot$District), gender_plot$PercentRemote)

p3 <- ggplot(gender_plot, aes(PercentRemote,district_remover_per_reorder2)) +
  geom_point(aes(color =Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing gender vs. remote learning per District")
p3
```

```{r}
ELL_plot <- df%>%filter(DisaggregationCategory == "English Language Learner Status")
district_remover_per_reorder3 <- fct_reorder(as.character(ELL_plot$District), ELL_plot$PercentRemote)

p4 <- ggplot(ELL_plot, aes(PercentRemote,district_remover_per_reorder3)) +
  geom_point(aes(color=Category)) + geom_line(aes(group = District),alpha=0.3) +
  xlab("% Remote")+
  ylab("District")+theme_linedraw()+
  ggtitle("Cleveland dot plot of Percent showing ELL vs. remote learning per District")
p4
```

### Two Cleveland dot plot with facets showing ethnicity and grade

```{r fig.height=6 }

Ethnicity_plot <- df%>%filter(DisaggregationCategory == "Race or Ethnicity")

p5 <- ggplot(Ethnicity_plot, aes(x = reorder_within(District, PercentRemote, Category), y = PercentRemote)) +
    geom_point(color="darksalmon",stat = "identity") + scale_x_reordered() +
    facet_wrap(Category ~ ., ncol = 1, scales = "free_x", strip.position = "right", )+ylab("% Remote")+ xlab("District") + ggtitle("Cleveland dot plot of Percent with facets showing Race or Ethnicity")

p5
```
```{r fig.height=6 }

Grade_plot <- df%>%filter(DisaggregationCategory == "Grade Level")

p6 <- ggplot(Grade_plot, aes(x = reorder_within(District, PercentRemote, Category), y = PercentRemote)) +
    geom_point(color="darksalmon",stat = "identity") + scale_x_reordered() +
    facet_wrap(Category ~ ., ncol = 1, scales = "free_x", strip.position = "right")+ylab("% Remote")+ xlab("District") + ggtitle("Cleveland dot plot of Percent with facets showing Grade Label")

p6
```

### Parallel coordinates plot

```{r pcp}
#this isn't working i am going to work on this tomorrow
#highlight the clusters based on the Species column
pcpdf <- df_total %>% subset(select=c("ELAScores2019","ELAScores2022","MathScores2019","MathScores2022","remote_cat")) 

#highlight the clusters based on the remote categorical column
p7<-pcpdf %>%  arrange(desc(remote_cat)) %>% ggparcoord(pcpdf, columns=1:4, groupColumn = 5, title = "Parallel Coordiantes Plot for average test scores per district, grouped by percent remote",scale = "globalminmax",
    alphaLines = 0.3)+ 
  scale_fill_hue(l=40)+
theme(
    plot.title = element_text(size=10)
  ) +
  xlab("") + ylab("Scores") + 
  scale_x_discrete(labels = c('ELA Scores 2019','ELA Scores 2022','Math Scores 2019','Math Scores 2022' ))
p7
```

### Boxplot

```{r}

bpELA2019 <- gender_plot %>% mutate(remote_cat = fct_reorder(remote_cat, -ELAScores2019, .fun='median')) %>% ggplot(aes(x=Category,y=ELAScores2019,fill=remote_cat)) + geom_boxplot(alpha=1) + scale_fill_brewer(palette="Paired") +ylab("Scores")+ xlab(" ") + labs(fill='Remote Preference')
bpELA2022 <- gender_plot %>% mutate(remote_cat = fct_reorder(remote_cat, -ELAScores2022, .fun='median')) %>% ggplot(aes(fill=remote_cat, y=ELAScores2022, x=reorder(Category, ELAScores2022, median))) + geom_boxplot(alpha=1) +
    scale_fill_brewer(palette="Paired") + ylab(" ")+ xlab(" ")+ labs(fill='Remote Preference')
bpMath2019 <- gender_plot %>% mutate(remote_cat = fct_reorder(remote_cat, -MathScores2019, .fun='median')) %>%ggplot(aes(fill=remote_cat, y=MathScores2019, x=reorder(Category, MathScores2019, median))) + geom_boxplot(alpha=1) +
    scale_fill_brewer(palette="Paired") + ylab("Scores")+ xlab(" ")+ labs(fill='Remote Preference')
bpMath2022 <- gender_plot %>% mutate(remote_cat = fct_reorder(remote_cat, -MathScores2022, .fun='median')) %>% ggplot(aes(fill=remote_cat, y=MathScores2022, x=reorder(Category, MathScores2022, median))) + geom_boxplot(alpha=1) +
    scale_fill_brewer(palette="Paired") + ylab(" ")+ xlab(" ")+ labs(fill='Remote Preference')

bptotal <- ggarrange(bpELA2019,bpELA2022,bpMath2019,bpMath2022, ncol = 2, nrow = 2)
bptotal

```

```{r}

Grade_plot <- df%>%filter(DisaggregationCategory == "English Language Learner Status" | DisaggregationCategory== "Gender" | DisaggregationCategory=="Race or Ethnicity")
Grade_plot

```